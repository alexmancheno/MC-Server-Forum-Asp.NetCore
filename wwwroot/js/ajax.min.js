!function(t){"use strict";phpbb.addAjaxCallback("mark_forums_read",function(e){var a=e.NO_UNREAD_POSTS,o=e.UNREAD_POSTS,i={forum_unread:"forum_read",forum_unread_subforum:"forum_read_subforum",forum_unread_locked:"forum_read_locked"};t("li.row").find('dl[class*="forum_unread"]').each(function(){var e=t(this);t.each(i,function(t,a){e.hasClass(t)&&e.removeClass(t).addClass(a)}),e.children('dt[title="'+o+'"]').attr("title",a)}),t('a.subforum[class*="unread"]').removeClass("unread").addClass("read"),t("#active_topics").length&&phpbb.ajaxCallbacks.mark_topics_read.call(this,e,!1),t('[data-ajax="mark_forums_read"]').attr("href",e.U_MARK_FORUMS),phpbb.closeDarkenWrapper(3e3)}),phpbb.addAjaxCallback("mark_topics_read",function(e,a){var o,i=e.NO_UNREAD_POSTS,n=e.UNREAD_POSTS,l={global_unread:"global_read",announce_unread:"announce_read",sticky_unread:"sticky_read",topic_unread:"topic_read"},r=["","_hot","_hot_mine","_locked","_locked_mine","_mine"],s={},d=[];"undefined"==typeof a&&(a=!0),t.each(l,function(e,a){t.each(r,function(t,o){return"_hot"!==o&&"_hot_mine"!==o||"topic_unread"===e?(s[e+o]=a+o,void d.push(e+o)):!0})}),o="."+d.join(",."),t("li.row").find(o).each(function(){var e=t(this);t.each(s,function(t,a){e.hasClass(t)&&e.removeClass(t).addClass(a)}),e.children('dt[title="'+n+'"]').attr("title",i)}),t("a").has("span.icon_topic_newest").remove(),a&&t('[data-ajax="mark_topics_read"]').attr("href",e.U_MARK_TOPICS),phpbb.closeDarkenWrapper(3e3)}),phpbb.addAjaxCallback("notification.mark_all_read",function(e){"undefined"!=typeof e.success&&(phpbb.markNotifications(t("#notification_list li.bg2"),0),phpbb.closeDarkenWrapper(3e3))}),phpbb.addAjaxCallback("notification.mark_read",function(e){if("undefined"!=typeof e.success){var a=Number(t("#notification_list_button strong").html())-1;phpbb.markNotifications(t(this).parent("li.bg2"),a)}}),phpbb.markNotifications=function(e,a){e.removeClass("bg2"),e.find("a.mark_read").remove(),e.each(function(){var e=t(this).find("a");e.attr("href",e.attr("data-real-url"))}),t("strong","#notification_list_button").html(a),a||t("#mark_all_notifications").remove();var o=t("title"),i=o.text().replace(/(\((\d+)\))/,"");o.text((a?"("+a+")":"")+i)},phpbb.addAjaxCallback("post_delete",function(){var e,a=t(this);if(void 0===a.attr("data-refresh")){e=a[0].href.split("&p=")[1];var o=a.parents("#p"+e).css("pointer-events","none");if(o.hasClass("bg1")||o.hasClass("bg2")){var i=o.nextAll(".bg1");o.nextAll(".bg2").removeClass("bg2").addClass("bg1"),i.removeClass("bg1").addClass("bg2")}o.fadeOut(function(){t(this).remove()})}}),phpbb.addAjaxCallback("post_visibility",function(e){var a=e.visible?t(this):t(this).parents(".post");t(a).css("pointer-events","none").fadeOut(function(){t(this).remove()}),e.visible&&a.parents(".post").find(".post_deleted_msg").css("pointer-events","none").fadeOut(function(){t(this).remove()})}),phpbb.addAjaxCallback("row_delete",function(){t(this).parents("tr").remove()}),phpbb.addAjaxCallback("zebra",function(e){var a;e.success&&(a=t(".zebra"),a.first().html(e.MESSAGE_TEXT),a.not(":first").html("&nbsp;").prev().html("&nbsp;"))}),phpbb.addAjaxCallback("vote_poll",function(e){if("undefined"!=typeof e.success){var a=t(".topic-poll"),o=a.find(".poll-panel"),i=a.find("div:first-child .poll-option-resultbar").is(":visible"),n=0,l=function(t){t="undefined"==typeof t?o.find(".topic-poll").outerHeight():t,o.css("min-height",t)};l(),i||a.find(".poll-view-results").hide(500),e.can_vote?a.find(".poll_max_votes, .poll-actions, .poll-option-resultbar, .poll-option-result").show(500):a.find(".poll_max_votes, .poll-actions, .poll-option-resultbar, .poll-option-result").fadeOut(500,function(){a.find(".poll_max_votes, .poll-actions, .poll-option-resultbar, .poll-option-result").show()}),a.find("[data-poll-option-id]").each(function(){var a=t(this),o=a.attr("data-poll-option-id");n=e.vote_counts[o]>=n?e.vote_counts[o]:n}),a.find(".poll_total_vote_cnt").html(e.total_votes),a.find("[data-poll-option-id]").each(function(){var a,o=t(this),i=o.attr("data-poll-option-id"),l="undefined"!=typeof e.user_votes[i],r=(e.vote_counts[i]===n,e.total_votes?Math.round(e.vote_counts[i]/e.total_votes*100):0),s=0===n?0:Math.round(e.vote_counts[i]/n*100);a=o.attr("data-alt-text"),l?o.attr("title",t.trim(a)):o.attr("title","");var d=o.find(".poll-option-resultbar div"),p=e.can_vote?500:1500,c=o.find(".poll-option-number");setTimeout(function(){d.animate({width:s+"%"},500),c.html(e.vote_counts[i]);var t=r?r+"%":e.NO_VOTES;o.find(".poll-option-percent").html(t)},p)}),e.can_vote||a.find(".polls").delay(400).fadeIn(500);var r=e.can_vote?300:900;a.find(".poll-vote-submitted").delay(r).slideDown(200,function(){i&&l(),t(this).delay(5e3).fadeOut(500,function(){s(300)})}),setTimeout(function(){s(500)},1500);var s=function(t){var e=o.height(),a=o.find(".inner").outerHeight();e!==a&&o.css({minHeight:"",height:e}).animate({height:a},t,function(){o.css({minHeight:a,height:""})})}}}),t(".poll-view-results a").click(function(e){e.preventDefault();var a=t(this).parents(".topic-poll");a.find(".poll-option-resultbar, .poll-option-result, .votes").show(500),a.find(".poll-view-results").hide(500)}),t("[data-ajax]").each(function(){var e=t(this),a=e.attr("data-ajax"),o=e.attr("data-filter");if("false"!==a){var i="true"!==a?a:null;o=void 0!==o?phpbb.getFunctionByName(o):null,phpbb.ajaxify({selector:this,refresh:void 0!==e.attr("data-refresh"),filter:o,callback:i})}}),t("#qr_full_editor").click(function(){t("#qr_postform").attr("action",function(t,e){return e+"#preview"})}),t(".display_post").click(function(e){e.preventDefault();var a=t(this).attr("data-post-id");t("#post_content"+a).show(),t("#profile"+a).show(),t("#post_hidden"+a).hide()}),t("#member_search").click(function(){var e=t("#memberlist_search");return e.slideToggle("fast"),phpbb.ajaxCallbacks.alt_text.call(this),e.is(":visible")&&t("#username").focus(),!1}),t(function(){var e=t("textarea:not(#message-box textarea, .no-auto-resize)");phpbb.resizeTextArea(e,{minHeight:75,maxHeight:250}),phpbb.resizeTextArea(t("textarea","#message-box"))})}(jQuery);